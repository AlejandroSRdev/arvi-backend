/**
 * HabitSeriesFromAIMapper (Application Layer)
 *
 * Transforms parsed AI output into a valid HabitSeries domain entity.
 *
 * This is the ONLY place where AI output structure is coupled
 * to domain entity construction. The domain itself remains
 * fully agnostic of AI concerns.
 */

const HabitSeries = require("../../01domain/entities/HabitSeries.js");
const Action = require("../../01domain/value_objects/habits/Action.js");

/**
 * Maps parsed AI output into a HabitSeries domain entity.
 *
 * @param id - Series ID (generated by persistence layer)
 * @param aiOutput - Validated AI output with title, description, and actions
 * @returns A valid HabitSeries domain entity
 */
function mapAIOutputToHabitSeries(
  id,
  aiOutput
) {
  console.log(`[MAPPER] [Application] mapAIOutputToHabitSeries called for id=${id}, actions=${aiOutput.actions.length}`);

  const actions = aiOutput.actions.map((raw, index) =>
    Action.fromAIOutput(raw, `${id}_action_${index}`)
  );

  const habitSeries = HabitSeries.create({
    id,
    title: aiOutput.title,
    description: aiOutput.description,
    actions,
  });

  console.log(`[MAPPER] [Application] mapAIOutputToHabitSeries OK â†’ title="${habitSeries.title}", actions=${habitSeries.actions.length}`);

  return habitSeries;
}

module.exports = {
  mapAIOutputToHabitSeries
};
